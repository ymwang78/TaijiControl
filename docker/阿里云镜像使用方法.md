# 阿里云镜像使用方法

## 1. 登录阿里云 ACR

```bash
docker login --username=aptx4869kkzhang crpi-swv7jpn7r1f9m0l3.cn-hangzhou.personal.cr.aliyuncs.com
```

固定密码：

```text
Taiji12345
```

## 2. 从Registry中拉取镜像

根据你在 `images.txt` 中配置的原始镜像名，以及 `sync.sh` 脚本的命名转换规则（将 `/` 替换为 `-`），构造完整的 ACR 镜像路径进行拉取。
当前的image.txt中的内容为：

```text
nginx:1.28.0
nginx:1.29.1-bookworm
ubuntu:22.04
python:3.9-slim
python:3.13-slim
metacubex/mihomo:v1.19.14
timescale/timescaledb:2.21.4-pg17
python:3.13-slim-trixie
python:3.13-trixie
python:3.12-slim-trixie
python:3.12-trixie
python:3.12-slim-bookworm
python:3.12-bookworm
testcontainers/helloworld:1.3.0
kkzhang3/taiji-pysim:v1.0.0
kkzhang3/taiji-tsdbclient:v1.0.0
```

```bash
# 例如，如果想要拉取 kkzhang3/taiji-tsdbclient:v1.0.0 
# ACR中的名称会变成 kkzhang3-taiji-tsdbclient:v1.0.0 
docker pull crpi-swv7jpn7r1f9m0l3.cn-hangzhou.personal.cr.aliyuncs.com/kk3/kkzhang3-taiji-tsdbclient:v1.0.0
```

```bash
# 例如，如果想要拉取 timescale/timescaledb:2.21.4-pg17 
# ACR中的名称会变成 timescale-timescaledb:2.21.4-pg17 
docker pull crpi-swv7jpn7r1f9m0l3.cn-hangzhou.personal.cr.aliyuncs.com/kk3/timescale-timescaledb:2.21.4-pg17
```

```bash
# 例如，如果想要拉取 kkzhang3/taiji-pysim:v1.0.0
# ACR中的名称会变成 kkzhang3-taiji-pysim:v1.0.0
docker pull crpi-swv7jpn7r1f9m0l3.cn-hangzhou.personal.cr.aliyuncs.com/kk3/kkzhang3-taiji-pysim:v1.0.0
```

## 3 创建本地 Tag，以便在 Dockerfile 或 docker-compose.yml 中使用原始镜像名

列出本地镜像的命令：`docker images`
如果你希望在 Dockerfile 中继续使用 `FROM kkzhang3/taiji-pysim:v1.0.0` 这样的原始镜像名，或者在 `docker-compose.yml` 中直接引用，你可以在拉取到 ACR 镜像后，为它创建一个本地 Tag。

```bash
# 创建一个指向本地 ACR 镜像的原始名称 Tag
docker tag crpi-swv7jpn7r1f9m0l3.cn-hangzhou.personal.cr.aliyuncs.com/kk3/kkzhang3-taiji-tsdbclient:v1.0.0  kkzhang3/taiji-tsdbclient:v1.0.0 

docker tag crpi-swv7jpn7r1f9m0l3.cn-hangzhou.personal.cr.aliyuncs.com/kk3/kkzhang3-taiji-pysim:v1.0.0  kkzhang3/taiji-pysim:v1.0.0 

docker tag crpi-swv7jpn7r1f9m0l3.cn-hangzhou.personal.cr.aliyuncs.com/kk3/timescale-timescaledb:2.21.4-pg17 timescale/timescaledb:2.21.4-pg17 
```

通过这种方式，你可以最大程度地减少对现有项目配置的修改。

### 可选，删除某个标签

如果你想**删除某个标签（tag）**，使用：

```bash
docker rmi <image:tag>
```

例如：

```bash
docker rmi crpi-swv7jpn7r1f9m0l3.cn-hangzhou.personal.cr.aliyuncs.com/kk3/kkzhang3-taiji-tsdbclient:v1.0.0 
```

## 4. 镜像文件的导出与导入

### 4.1 导出镜像为 tar 包

在你的机器上执行：

```bash
docker save -o timescale_timescaledb_2.21.4-pg17.tar timescale/timescaledb:2.21.4-pg17
```

说明：

- `-o timescale_timescaledb_2.21.4-pg17.tar` → 输出文件名，可以随便取

- `timescale/timescaledb:2.21.4-pg17` → 镜像名和标签

执行完成后，你会在当前目录得到一个 `timescale_timescaledb_2.21.4-pg17.tar` 文件。

---

### 4.2 把 tar 包拷贝到其它机器

可以用 `scp`、U盘、rsync 等方式复制到目标机器

---

### 4.3 在目标机器导入镜像

在目标机器执行：

```bash
docker load -i timescale_timescaledb_2.21.4-pg17.tar
```

完成后会看到：

```Loaded image: timescale/timescaledb:2.21.4-pg17```

---

### 4.4 验证镜像是否存在

```bash
docker images
```

应该能看到 `timescale/timescaledb:2.21.4-pg17`。

---

✅ **总结**：

- 用 `docker save` 导出

- 拷贝 `.tar` 文件到另一台机器

- 用 `docker load` 导入
